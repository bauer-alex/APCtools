<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Plot the heatmap of an APC structure. The function can be used in two ways:
Either to plot the observed mean structure of a metric variable, by
specifying dat and the variable y_var, or by specifying
dat and the model object, to plot some mean structure
represented by an estimated two-dimensional tensor product surface. The model
must be estimated with gam."><title>Heatmap of an APC surface — plot_APCheatmap • APCtools</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Heatmap of an APC surface — plot_APCheatmap"><meta property="og:description" content="Plot the heatmap of an APC structure. The function can be used in two ways:
Either to plot the observed mean structure of a metric variable, by
specifying dat and the variable y_var, or by specifying
dat and the model object, to plot some mean structure
represented by an estimated two-dimensional tensor product surface. The model
must be estimated with gam."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">APCtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/main_functionality.html">Main Functionality</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bauer-alex/APCtools">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Heatmap of an APC surface</h1>
      
      <div class="d-none name"><code>plot_APCheatmap.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Plot the heatmap of an APC structure. The function can be used in two ways:
Either to plot the observed mean structure of a metric variable, by
specifying <code>dat</code> and the variable <code>y_var</code>, or by specifying
<code>dat</code> and the <code>model</code> object, to plot some mean structure
represented by an estimated two-dimensional tensor product surface. The model
must be estimated with <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">plot_APCheatmap</span><span class="op">(</span>
  <span class="va">dat</span>,
  y_var <span class="op">=</span> <span class="cn">NULL</span>,
  model <span class="op">=</span> <span class="cn">NULL</span>,
  dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"period"</span>, <span class="st">"age"</span><span class="op">)</span>,
  apc_range <span class="op">=</span> <span class="cn">NULL</span>,
  bin_heatmap <span class="op">=</span> <span class="cn">TRUE</span>,
  bin_heatmapGrid_list <span class="op">=</span> <span class="cn">NULL</span>,
  markLines_list <span class="op">=</span> <span class="cn">NULL</span>,
  markLines_displayLabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"period"</span>, <span class="st">"cohort"</span><span class="op">)</span>,
  y_var_logScale <span class="op">=</span> <span class="cn">FALSE</span>,
  plot_CI <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>dat</dt>
<dd><p>Dataset with columns <code>period</code> and <code>age</code>. If <code>y_var</code>
is specified, the dataset must contain the respective column. If <code>model</code>
is specified, the dataset must have been used for model estimation with
<code>gam</code>.</p></dd>
<dt>y_var</dt>
<dd><p>Optional character name of a metric variable to be plotted.</p></dd>
<dt>model</dt>
<dd><p>Optional regression model estimated with <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></code>
to estimate a smoothed APC surface. Only used if <code>y_var</code> is not
specified.</p></dd>
<dt>dimensions</dt>
<dd><p>Character vector specifying the two APC dimensions that
should be visualized along the x-axis and y-axis. Defaults to
<code>c("period","age")</code>.</p></dd>
<dt>apc_range</dt>
<dd><p>Optional list with one or multiple elements with names
<code>"age","period","cohort"</code> to filter the data. Each element should
contain a numeric vector of values for the respective variable that should
be kept in the data. All other values are deleted.</p></dd>
<dt>bin_heatmap, bin_heatmapGrid_list</dt>
<dd><p><code>bin_heatmap</code> indicates if the
heatmap surface should be binned. Defaults to TRUE. If TRUE, the binning
grid borders are defined by <code>bin_heatmapGrid_list</code>. This is a list with
each element a numeric vector and a name out of
<code>c("age","period","cohort")</code>. Can maximally have three elements. Defaults
to NULL, where the heatmap is binned in 5 year steps along the x-axis and the
y-axis.</p></dd>
<dt>markLines_list</dt>
<dd><p>Optional list that can be used to highlight the borders
of specific age groups, time intervals or cohorts. Each element must be a
numeric vector of values where horizontal, vertical or diagonal lines should
be drawn (depends on which APC dimension is displayed on which axis).
The list can maximally have three elements and must have names out of
<code>c("age","period","cohort")</code>.</p></dd>
<dt>markLines_displayLabels</dt>
<dd><p>Optional character vector defining for which
dimensions the lines defined through <code>markLines_list</code> should be marked
by a respective label. The vector should be a subset of
<code>c("age","period","cohort")</code>, or NULL to suppress all labels.
Defaults to <code>c("age","period","cohort")</code>.</p></dd>
<dt>y_var_logScale</dt>
<dd><p>Indicator if <code>y_var</code> should be log10 transformed.
Only used if <code>y_var</code> is specified. Defaults to FALSE.</p></dd>
<dt>plot_CI</dt>
<dd><p>Indicator if the confidence intervals should be plotted.
Only used if <code>y_var</code> is not specified. Defaults to TRUE.</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Plot grid created with <code><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>See also <code><a href="plot_APChexamap.html">plot_APChexamap</a></code> to plot a hexagonal heatmap with
adapted axes.</p>
<p>If the plot is created based on the <code>model</code> object and the model was
estimated with a log or logit link, the function automatically performs an
exponential transformation of the effect.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Weigert, M., Bauer, A., Gernert, J., Karl, M., Nalmpatian, A.,
Küchenhoff, H., and Schmude, J. (2021). Semiparametric APC analysis of
destination choice patterns: Using generalized additive models to quantify
the impact of age, period, and cohort on travel distances.
<em>Tourism Economics</em>. doi:10.1177/1354816620987198.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>plot_APChexamap</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Alexander Bauer <a href="mailto:alexander.bauer@stat.uni-muenchen.de">alexander.bauer@stat.uni-muenchen.de</a>,
Maximilian Weigert <a href="mailto:maximilian.weigert@stat.uni-muenchen.de">maximilian.weigert@stat.uni-muenchen.de</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">APCtools</span><span class="op">)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">travel</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># variant A: plot observed mean structures</span></span>
<span class="r-in"><span class="co"># observed heatmap</span></span>
<span class="r-in"><span class="fu">plot_APCheatmap</span><span class="op">(</span>dat <span class="op">=</span> <span class="va">travel</span>, y_var <span class="op">=</span> <span class="st">"mainTrip_distance"</span>,</span>
<span class="r-in">                bin_heatmap <span class="op">=</span> <span class="cn">FALSE</span>, y_var_logScale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="plot_APCheatmap-1.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># with binning</span></span>
<span class="r-in"><span class="fu">plot_APCheatmap</span><span class="op">(</span>dat <span class="op">=</span> <span class="va">travel</span>, y_var <span class="op">=</span> <span class="st">"mainTrip_distance"</span>,</span>
<span class="r-in">                bin_heatmap <span class="op">=</span> <span class="cn">TRUE</span>, y_var_logScale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="plot_APCheatmap-2.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># variant B: plot some smoothed, estimated mean structure</span></span>
<span class="r-in"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">mainTrip_distance</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">te</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">period</span><span class="op">)</span> <span class="op">+</span> <span class="va">residence_region</span> <span class="op">+</span></span>
<span class="r-in">             <span class="va">household_size</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">household_income</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">travel</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># plot the smooth tensor product surface</span></span>
<span class="r-in"><span class="fu">plot_APCheatmap</span><span class="op">(</span>dat <span class="op">=</span> <span class="va">travel</span>, model <span class="op">=</span> <span class="va">model</span>, bin_heatmap <span class="op">=</span> <span class="cn">FALSE</span>, plot_CI <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="plot_APCheatmap-3.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># ... same plot including the confidence intervals</span></span>
<span class="r-in"><span class="fu">plot_APCheatmap</span><span class="op">(</span>dat <span class="op">=</span> <span class="va">travel</span>, model <span class="op">=</span> <span class="va">model</span>, bin_heatmap <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="plot_APCheatmap-4.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># the APC dimensions can be flexibly assigned to the x-axis and y-axis</span></span>
<span class="r-in"><span class="fu">plot_APCheatmap</span><span class="op">(</span>dat <span class="op">=</span> <span class="va">travel</span>, model <span class="op">=</span> <span class="va">model</span>, dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>,<span class="st">"cohort"</span><span class="op">)</span>,</span>
<span class="r-in">                bin_heatmap <span class="op">=</span> <span class="cn">FALSE</span>, plot_CI <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="plot_APCheatmap-5.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># add some reference lines</span></span>
<span class="r-in"><span class="fu">plot_APCheatmap</span><span class="op">(</span>dat <span class="op">=</span> <span class="va">travel</span>, model <span class="op">=</span> <span class="va">model</span>, bin_heatmap <span class="op">=</span> <span class="cn">FALSE</span>, plot_CI <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span class="r-in">                markLines_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1910</span>,<span class="fl">1939</span>,<span class="fl">1955</span>,<span class="fl">1980</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-plt img"><img src="plot_APCheatmap-6.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># default binning of the tensor product surface in 5-year-blocks</span></span>
<span class="r-in"><span class="fu">plot_APCheatmap</span><span class="op">(</span>dat <span class="op">=</span> <span class="va">travel</span>, model <span class="op">=</span> <span class="va">model</span>, plot_CI <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="plot_APCheatmap-7.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># manual binning</span></span>
<span class="r-in"><span class="va">manual_binning</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">travel</span><span class="op">$</span><span class="va">period</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span class="r-in">                                    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">travel</span><span class="op">$</span><span class="va">period</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span class="r-in">                       cohort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">travel</span><span class="op">$</span><span class="va">period</span> <span class="op">-</span> <span class="va">travel</span><span class="op">$</span><span class="va">age</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span class="r-in">                                    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">travel</span><span class="op">$</span><span class="va">period</span> <span class="op">-</span> <span class="va">travel</span><span class="op">$</span><span class="va">age</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">plot_APCheatmap</span><span class="op">(</span>dat <span class="op">=</span> <span class="va">travel</span>, model <span class="op">=</span> <span class="va">model</span>, plot_CI <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span class="r-in">                bin_heatmapGrid_list <span class="op">=</span> <span class="va">manual_binning</span><span class="op">)</span></span>
<span class="r-plt img"><img src="plot_APCheatmap-8.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Alexander Bauer, Maximilian Weigert, Hawre Jalal.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer></div>

  

  

  </body></html>

