<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Hexamap of an APC surface — plot_APChexamap • APCtools</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Hexamap of an APC surface — plot_APChexamap"><meta name="description" content="Plot the heatmap of an APC structure using a hexagon-based plot with adapted
axes. In this way, the one temporal dimension that is represented by the
diagonal structure is visually not underrepresented compared to the other two
dimensions on the x-axis and y-axis.
The function can be used in two ways: Either to plot the observed mean
structure of a metric variable, by specifying dat and the variable
y_var, or by specifying dat and the model object, to
plot some mean structure represented by an estimated two-dimensional tensor
product surface. The model must be estimated with gam or
bam."><meta property="og:description" content="Plot the heatmap of an APC structure using a hexagon-based plot with adapted
axes. In this way, the one temporal dimension that is represented by the
diagonal structure is visually not underrepresented compared to the other two
dimensions on the x-axis and y-axis.
The function can be used in two ways: Either to plot the observed mean
structure of a metric variable, by specifying dat and the variable
y_var, or by specifying dat and the model object, to
plot some mean structure represented by an estimated two-dimensional tensor
product surface. The model must be estimated with gam or
bam."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">APCtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/main_functionality.html">APC Analysis with APCtools</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/bauer-alex/APCtools"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Hexamap of an APC surface</h1>
      <small class="dont-index">Source: <a href="https://github.com/bauer-alex/APCtools/blob/main/R/plot_APChexamap.R" class="external-link"><code>R/plot_APChexamap.R</code></a></small>
      <div class="d-none name"><code>plot_APChexamap.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Plot the heatmap of an APC structure using a hexagon-based plot with adapted
axes. In this way, the one temporal dimension that is represented by the
diagonal structure is visually not underrepresented compared to the other two
dimensions on the x-axis and y-axis. <br>
The function can be used in two ways: Either to plot the observed mean
structure of a metric variable, by specifying <code>dat</code> and the variable
<code>y_var</code>, or by specifying <code>dat</code> and the <code>model</code> object, to
plot some mean structure represented by an estimated two-dimensional tensor
product surface. The model must be estimated with <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></code> or
<code><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">plot_APChexamap</span><span class="op">(</span></span>
<span>  <span class="va">dat</span>,</span>
<span>  y_var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  apc_range <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  y_var_logScale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  obs_interval <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  iso_interval <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  color_vec <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  color_range <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  line_width <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  line_color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">gray</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  label_size <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  label_color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>  legend_title <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dat">dat<a class="anchor" aria-label="anchor" href="#arg-dat"></a></dt>
<dd><p>Dataset with columns <code>period</code> and <code>age</code>. If <code>y_var</code>
is specified, the dataset must contain the respective column. If <code>model</code>
is specified, the dataset must have been used for model estimation with
<code>gam</code> or <code>bam</code>.</p></dd>


<dt id="arg-y-var">y_var<a class="anchor" aria-label="anchor" href="#arg-y-var"></a></dt>
<dd><p>Optional character name of a metric variable to be plotted.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>Optional regression model estimated with <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></code>
or <code><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam</a></code> to estimate a smoothed APC surface. Only used if
<code>y_var</code> is not
specified.</p></dd>


<dt id="arg-apc-range">apc_range<a class="anchor" aria-label="anchor" href="#arg-apc-range"></a></dt>
<dd><p>Optional list with one or multiple elements with names
<code>"age","period","cohort"</code> to filter the data. Each element should
contain a numeric vector of values for the respective variable that should
be kept in the data. All other values are deleted.</p></dd>


<dt id="arg-y-var-logscale">y_var_logScale<a class="anchor" aria-label="anchor" href="#arg-y-var-logscale"></a></dt>
<dd><p>Indicator if <code>y_var</code> should be log10 transformed.
Only used if <code>y_var</code> is specified. Defaults to FALSE.</p></dd>


<dt id="arg-obs-interval">obs_interval<a class="anchor" aria-label="anchor" href="#arg-obs-interval"></a></dt>
<dd><p>Numeric specifying the interval width based on which the
data is spaced. Only used if <code>y_var</code> is specified. Defaults to 1, i.e.
observations each year.</p></dd>


<dt id="arg-iso-interval">iso_interval<a class="anchor" aria-label="anchor" href="#arg-iso-interval"></a></dt>
<dd><p>Numeric specifying the interval width between the
isolines along each axis. Defaults to 5.</p></dd>


<dt id="arg-color-vec">color_vec<a class="anchor" aria-label="anchor" href="#arg-color-vec"></a></dt>
<dd><p>Optional character vector of color names, specifying the
color continuum.</p></dd>


<dt id="arg-color-range">color_range<a class="anchor" aria-label="anchor" href="#arg-color-range"></a></dt>
<dd><p>Optional numeric vector with two elements, specifying the
ends of the color scale in the legend.</p></dd>


<dt id="arg-line-width">line_width<a class="anchor" aria-label="anchor" href="#arg-line-width"></a></dt>
<dd><p>Line width of the isolines. Defaults to 0.5.</p></dd>


<dt id="arg-line-color">line_color<a class="anchor" aria-label="anchor" href="#arg-line-color"></a></dt>
<dd><p>Character color name for the isolines. Defaults to gray.</p></dd>


<dt id="arg-label-size">label_size<a class="anchor" aria-label="anchor" href="#arg-label-size"></a></dt>
<dd><p>Size of the labels along the axes. Defaults to 0.5.</p></dd>


<dt id="arg-label-color">label_color<a class="anchor" aria-label="anchor" href="#arg-label-color"></a></dt>
<dd><p>Character color name for the labels along the axes.</p></dd>


<dt id="arg-legend-title">legend_title<a class="anchor" aria-label="anchor" href="#arg-legend-title"></a></dt>
<dd><p>Optional character title for the legend.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Creates a plot with base R functions (not <code>ggplot2</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>See also <code><a href="plot_APCheatmap.html">plot_APCheatmap</a></code> to plot a regular heatmap.</p>
<p>If the plot is created based on the <code>model</code> object and the model was
estimated with a log or logit link, the function automatically performs an
exponential transformation of the effect.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Jalal, H., Burke, D. (2020). Hexamaps for Age–Period–Cohort
Data Visualization and Implementation in R.
<em>Epidemiology</em>, 31 (6), e47-e49. doi: 10.1097/EDE.0000000000001236.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="plot_APCheatmap.html">plot_APCheatmap</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Hawre Jalal <a href="mailto:hjalal@pitt.edu">hjalal@pitt.edu</a>,
Alexander Bauer <a href="mailto:alexander.bauer@stat.uni-muenchen.de">alexander.bauer@stat.uni-muenchen.de</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bauer-alex.github.io/APCtools/" class="external-link">APCtools</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘dplyr’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:nlme’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     collapse</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     filter, lag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     intersect, setdiff, setequal, union</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">drug_deaths</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># restrict to data where the mortality rate is available</span></span></span>
<span class="r-in"><span><span class="va">drug_deaths</span> <span class="op">&lt;-</span> <span class="va">drug_deaths</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">mortality_rate</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># hexamap of an observed structure</span></span></span>
<span class="r-in"><span><span class="fu">plot_APChexamap</span><span class="op">(</span>dat         <span class="op">=</span> <span class="va">drug_deaths</span>,</span></span>
<span class="r-in"><span>                y_var       <span class="op">=</span> <span class="st">"mortality_rate"</span>,</span></span>
<span class="r-in"><span>                color_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">40</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot_APChexamap-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># hexamap of a smoothed structure</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">mortality_rate</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">te</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">period</span>, bs <span class="op">=</span> <span class="st">"ps"</span>, k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             data <span class="op">=</span> <span class="va">drug_deaths</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">plot_APChexamap</span><span class="op">(</span>dat <span class="op">=</span> <span class="va">drug_deaths</span>, model <span class="op">=</span> <span class="va">model</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot_APChexamap-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alexander Bauer, Maximilian Weigert, Hawre Jalal.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

