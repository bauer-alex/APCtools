---
title: "Functionality of APCtools package"
author: "Alexander Bauer, Maximilian Weigert, Pauline Hohenemser"
date: "`r format(Sys.time(), '%d.%B %Y')`"
output:
  html_document:
    toc: yes
  vignette: >
    %\VignetteIndexEntry{Functionality of TouristClust package}
    %\usepackage[utf8]{inputenc}
    %\VignetteEngine{knitr::rmarkdown}
  rmarkdown::html_vignette: default
editor_options:
  chunk_output_type: console
---

This document gives an overview of the functionality provided by the R package
`APCtools`.

```{r packages, message = FALSE}
library(APCtools)
library(dplyr)
library(mgcv)

# set the global theme of all plots
library(ggplot2)
theme_set(theme_minimal())
```

### Prepare data

```{r data preparation}
data(data_RA)

data_RA <- data_RA %>% 
  dplyr::rename(age    = S_Alter,
                period = travel_year) %>% 
  mutate(cohort = period - age)
```

# Descriptive analyses

### 1D visualization function for metric and categorical variables

```{r}
# plot a metric variable
plot_variable(dat = data_RA, variable = "JS_HUR_Reisedistanz", apc_dimension = "period")

# plot a categorical variable
plot_variable(dat = data_RA, variable = "S_Haushaltsgroesse", apc_dimension = "period")
```

### Ridgeline matrix for metric and categorical variables

```{r ridgeline matrix}
load_all()
plot_density(data_RA, y_var = "JS_HUR_Reisedistanz", log_scale = TRUE)
plot_density(data_RA, y_var = "JS_HUR_Reisedistanz",
             y_var_breaks = c(1,1000,5000,20000),
             weights_var = "G_Gewichtung", log_scale = TRUE)
plot_density(data_RA, y_var = "S_Haushaltsgroesse")
plot_density(data_RA, y_var = "S_Haushaltsgroesse", weights_var = "G_Gewichtung")

# plot_ridgeline(data_RA, y_var = "JS_HUR_Reisedistanz")
# plot_ridgelineMatrix(data_RA)
# TODO metric
# TODO categorical
```


# Model-based analyses

### Wrapper function for the estimation of mgcv::gam

```{r}
# TODO

model_pure <- gam(JS_HUR_Reisedistanz ~ te(age, period), data = data_RA)
model_cov  <- gam(JS_HUR_Reisedistanz ~ te(age, period) +
                    S_Herkunft + S_Haushaltsgroesse + s(S_Einkommen_HH), data = data_RA)
```

### Partial effect plots

```{r}
APCtools::plot_partialAPCeffects(model_pure, dat = data_RA, variable = "cohort")
APCtools::plot_marginalAPCeffects(model_pure, dat = data_RA, variable = "period")

model_list <- list("pure model"      = model_pure,
                   "covariate model" = model_cov)
APCtools::plot_jointMarginalAPCEffects(model_list, dat = data_RA)
```

### Heatmaps

```{r}
APCtools::plot_APCheatmap(model_pure, dat = data_RA)
```

### Hexamaps

```{r}
# TODO
```

### 3D plot of the heatmap

```{r}
# TODO
```

### Overview table

```{r}
create_APCsummary(model_list, dat = data_RA)
```

### Effect plots of linear and nonlinear effects

```{r}
APCtools::plot_linearEffects(model_cov)
APCtools::plot_1Dsmooth(model_cov, select = 2)
```

### Overview tables of linear and nonlinear effects

```{r}
summary_list <- create_covariateSummary(model_list)
summary_list[[1]]
summary_list[[2]]
```


### Model evaluation

```{r}
# TODO
```
